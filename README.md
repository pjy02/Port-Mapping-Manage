# Port-Mapping-Manage

[![Version](https://img.shields.io/badge/version-4.0-blue)](https://github.com/pjy02/Port-Mapping-Manage/blob/main/port_mapping_manager.sh)
[![License](https://img.shields.io/badge/license-MIT-green)](https://github.com/pjy02/Port-Mapping-Manage/blob/main/LICENSE)

> ğŸš€ **v4.0 é‡å¤§æ›´æ–°** - å¼ºå¤§ä¸”æ˜“ç”¨çš„ iptables ç«¯å£æ˜ å°„ç®¡ç†è„šæœ¬ï¼Œæ”¯æŒ **TCP / UDP** åè®®ã€IPv4/IPv6 åŒæ ˆã€æ‰¹é‡æ“ä½œã€è§„åˆ™æŒä¹…åŒ–ã€å®æ—¶æµé‡ç›‘æ§ã€æ™ºèƒ½è¯Šæ–­ç­‰ä¼ä¸šçº§ç‰¹æ€§ã€‚

---

## ğŸ“‘ é¡¹ç›®ç®€ä»‹

æœ¬è„šæœ¬æ—¨åœ¨ç®€åŒ– Linux æœåŠ¡å™¨ä¸Šçš„å¤§èŒƒå›´ç«¯å£è½¬å‘é…ç½®ä¸ç®¡ç†ï¼Œç‰¹åˆ«é€‚ç”¨äº **Hysteria2 / Xray / V2Ray / iperf** ç­‰éœ€è¦æ˜ å°„å¤§é‡ç«¯å£çš„åº”ç”¨åœºæ™¯ã€‚ç»è¿‡ v4.0 å…¨é¢é‡æ„ï¼Œç°å·²æˆä¸ºåŠŸèƒ½å®Œå–„ã€ç¨³å®šå¯é çš„ä¼ä¸šçº§ç«¯å£ç®¡ç†è§£å†³æ–¹æ¡ˆã€‚

### ğŸŒŸ æ ¸å¿ƒç‰¹æ€§

* **ğŸ¯ æ™ºèƒ½åŒ–ç®¡ç†**ï¼šæä¾›ç›´è§‚çš„äº¤äº’ç•Œé¢ï¼Œæ— éœ€è®°å¿†å¤æ‚å‘½ä»¤
* **ğŸ”„ åŒæ ˆæ”¯æŒ**ï¼šå®Œæ•´æ”¯æŒ IPv4 / IPv6 åŒåè®®æ ˆ
* **âš¡ åè®®çµæ´»**ï¼šæ”¯æŒ TCP / UDPï¼Œæ™ºèƒ½åè®®æ£€æµ‹å’ŒéªŒè¯
* **ğŸ“¦ æ‰¹é‡æ“ä½œ**ï¼šæ”¯æŒé…ç½®æ–‡ä»¶å¯¼å…¥/å¯¼å‡ºï¼Œä¸€é”®æ‰¹é‡ç®¡ç†
* **ğŸ“Š å®æ—¶ç›‘æ§**ï¼šå†…ç½®æµé‡ç»Ÿè®¡ã€é€Ÿç‡ç›‘æ§å’Œè¿æ¥çŠ¶æ€æ£€æµ‹
* **ğŸ›¡ï¸ å®‰å…¨å¯é **ï¼šå¢å¼ºçš„è¾“å…¥éªŒè¯ã€è‡ªåŠ¨å¤‡ä»½ã€æ™ºèƒ½æ¢å¤æœºåˆ¶
* **ğŸ”§ æ™ºèƒ½è¯Šæ–­**ï¼šå…¨é¢çš„ç³»ç»Ÿæ£€æµ‹ã€é—®é¢˜è¯Šæ–­å’Œè‡ªåŠ¨ä¿®å¤
* **âš™ï¸ æŒä¹…åŒ–é…ç½®**ï¼šå¤šç§æŒä¹…åŒ–æ–¹æ¡ˆï¼Œç¡®ä¿é‡å¯åè§„åˆ™è‡ªåŠ¨æ¢å¤
* **ğŸš€ æ€§èƒ½ä¼˜åŒ–**ï¼šç¼“å­˜æœºåˆ¶ã€æ‰¹é‡å¤„ç†ï¼Œå¤§å¹…æå‡æ‰§è¡Œæ•ˆç‡
* **ğŸŒ å¹¿æ³›å…¼å®¹**ï¼šæ”¯æŒ Debian / Ubuntu / CentOS / Rocky / AlmaLinux ç­‰ä¸»æµå‘è¡Œç‰ˆ

---

## ğŸš€ å¿«é€Ÿå¼€å§‹

> éœ€ **root** æƒé™æ‰§è¡Œï¼Œç¡®ä¿ç³»ç»Ÿå·²å®‰è£… `iptables` / `iptables-save` / `iptables-restore`ã€‚

```bash
# ä¸€é”®ä¸‹è½½å¹¶è¿è¡Œï¼ˆç¤ºä¾‹ï¼‰
bash <(curl -fsSL https://raw.githubusercontent.com/pjy02/Port-Mapping-Manage/refs/heads/main/install_pmm.sh)
```

### å¯é€‰å¯åŠ¨å‚æ•°

| å‚æ•° | è¯´æ˜ |
| ---- | ---- |
| `-v, --verbose` | æ˜¾ç¤ºæ›´å¤šè°ƒè¯•ä¿¡æ¯ |
| `--no-backup` | ç¦ç”¨è‡ªåŠ¨å¤‡ä»½ |
| `-h, --help` | æŸ¥çœ‹å¸®åŠ© |
| `--version` | æ˜¾ç¤ºè„šæœ¬ç‰ˆæœ¬ |

---

## ğŸ–¥ï¸ ä¸»èœå•ä¸€è§ˆ

### åŸºç¡€æ“ä½œ
| åºå· | åŠŸèƒ½ | è¯´æ˜ |
| ---- | ---- | ---- |
| 1 | è®¾ç½®ç«¯å£æ˜ å°„ (æ‰‹åŠ¨é…ç½®) | æ‰‹åŠ¨åˆ›å»ºæ–°çš„ç«¯å£è½¬å‘è§„åˆ™ |
| 2 | ä½¿ç”¨é¢„è®¾é…ç½® | ä½¿ç”¨é¢„å®šä¹‰çš„é…ç½®æ¨¡æ¿ |
| 3 | æŸ¥çœ‹å½“å‰è§„åˆ™ | æ˜¾ç¤ºæ‰€æœ‰æ´»è·ƒçš„æ˜ å°„è§„åˆ™ |
| 4 | è§„åˆ™ç®¡ç† (ç¼–è¾‘/åˆ é™¤) | ç¼–è¾‘æˆ–åˆ é™¤ç°æœ‰è§„åˆ™ |
| 5 | ç³»ç»Ÿè¯Šæ–­ | æ£€æŸ¥ç³»ç»Ÿç¯å¢ƒå’Œé…ç½®çŠ¶æ€ |

### é«˜çº§åŠŸèƒ½
| åºå· | åŠŸèƒ½ | è¯´æ˜ |
| ---- | ---- | ---- |
| 6 | æ‰¹é‡æ“ä½œ (å¯¼å…¥/å¯¼å‡º) | æ‰¹é‡å¯¼å…¥å¯¼å‡ºè§„åˆ™é…ç½® |
| 7 | å¤‡ä»½ç®¡ç† | ç®¡ç†è§„åˆ™å¤‡ä»½å’Œæ¢å¤ |
| 8 | å®æ—¶ç›‘æ§ | ç›‘æ§ç«¯å£æµé‡å’Œè¿æ¥çŠ¶æ€ |
| 9 | æ¢å¤è®¾ç½® | æ¢å¤ä¹‹å‰çš„é…ç½®è®¾ç½® |

### æŒä¹…åŒ–é…ç½®
| åºå· | åŠŸèƒ½ | è¯´æ˜ |
| ---- | ---- | ---- |
| 10 | æ°¸ä¹…ä¿å­˜å½“å‰è§„åˆ™ | é…ç½®è§„åˆ™æŒä¹…åŒ– |
| 11 | æ£€æŸ¥å’Œä¿®å¤æŒä¹…åŒ–é…ç½® | è¯Šæ–­å¹¶ä¿®å¤æŒä¹…åŒ–é—®é¢˜ |
| 12 | æµ‹è¯•æŒä¹…åŒ–é…ç½® | éªŒè¯æŒä¹…åŒ–é…ç½®æœ‰æ•ˆæ€§ |

### ç³»ç»Ÿç®¡ç†
| åºå· | åŠŸèƒ½ | è¯´æ˜ |
| ---- | ---- | ---- |
| 13 | å¸®åŠ©ä¿¡æ¯ | æ˜¾ç¤ºè¯¦ç»†çš„ä½¿ç”¨å¸®åŠ© |
| 14 | ç‰ˆæœ¬ä¿¡æ¯ | æ˜¾ç¤ºè„šæœ¬ç‰ˆæœ¬å’Œæ›´æ–°æ—¥å¿— |
| 15 | åˆ‡æ¢IPç‰ˆæœ¬ (IPv4/IPv6) | åœ¨IPv4å’ŒIPv6ä¹‹é—´åˆ‡æ¢ |
| 16 | æ£€æŸ¥æ›´æ–° | æ£€æŸ¥å¹¶æ›´æ–°åˆ°æœ€æ–°ç‰ˆæœ¬ |
| 17 | é€€å‡ºè„šæœ¬ | å®‰å…¨é€€å‡ºè„šæœ¬ |
| 99 | å¸è½½è„šæœ¬ | å®Œå…¨å¸è½½è„šæœ¬å’Œç›¸å…³é…ç½® |

---

## ğŸ”§ æ–°å¢æ˜ å°„ç¤ºä¾‹

1. é€‰æ‹© **1. æ–°å¢ç«¯å£æ˜ å°„**
2. æŒ‰æç¤ºä¾æ¬¡è¾“å…¥ï¼š
   * èµ·å§‹ç«¯å£ï¼š`6000`
   * ç»ˆæ­¢ç«¯å£ï¼š`7000`
   * æœ¬åœ°æœåŠ¡ç«¯å£ï¼š`3000`
   * åè®®ï¼š`1`ï¼ˆTCPï¼‰æˆ– `2`ï¼ˆUDPï¼‰
3. ç¡®è®¤åå³åˆ»ç”Ÿæ•ˆï¼Œå¯åœ¨ **3. æŸ¥çœ‹å½“å‰æ˜ å°„è§„åˆ™** ä¸­éªŒè¯ã€‚

---

## ğŸ“‚ æ‰¹é‡å¯¼å…¥ç¤ºä¾‹æ–‡ä»¶

è„šæœ¬å¯è¯»å–ä»¥ä¸‹æ ¼å¼çš„é…ç½®æ–‡ä»¶æ‰¹é‡å¯¼å…¥è§„åˆ™ï¼š

```text:sample_rules.conf
# æ ¼å¼: start_port:end_port:service_port
6000:7000:3000
8000:9000:4000
10000:12000:5000
```

---

## ğŸ›¡ï¸ å¤‡ä»½ä¸æ¢å¤

* **è‡ªåŠ¨å¤‡ä»½**ï¼šæ¯æ¬¡æ›´æ”¹ iptables å‰è‡ªåŠ¨å¤‡ä»½åˆ° `backups/` ç›®å½•ï¼Œé»˜è®¤ä¿ç•™ 10 ä»½
* **é€‰æ‹©æ€§æ¸…ç†**ï¼šåœ¨å¤‡ä»½ç®¡ç†èœå•è¾“å…¥åºå·ï¼ˆæ”¯æŒç©ºæ ¼/é€—å·ç­‰ä»»æ„åˆ†éš”ï¼‰æˆ–è¾“å…¥ `all` ä¸€é”®æ¸…ç©º
* **æ¢å¤å¤‡ä»½**ï¼šæŒ‰åºå·é€‰æ‹©éœ€è¦æ¢å¤çš„å¤‡ä»½æ–‡ä»¶ï¼Œæ”¯æŒè¦†ç›–å½“å‰å…¨éƒ¨è§„åˆ™

---

## ğŸ“Š å®æ—¶ç›‘æ§

åœ¨ **8. å®æ—¶ç›‘æ§** ä¸­ï¼Œå¯æ¯ç§’æŸ¥çœ‹ç´¯è®¡æ•°æ®åŒ…ã€å­—èŠ‚æ•°ä¸å®æ—¶é€Ÿç‡ï¼Œæ–¹ä¾¿æ’æŸ¥æµé‡ç“¶é¢ˆã€‚

---

## ğŸ†˜ æ•…éšœæ’æŸ¥

1. ç¡®è®¤è„šæœ¬ä»¥ **root** èº«ä»½æ‰§è¡Œ
2. æ£€æŸ¥ `iptables` æ˜¯å¦æ­£å¸¸å·¥ä½œï¼š`iptables -L -n`
3. è‹¥è§„åˆ™æœªç”Ÿæ•ˆï¼Œå°è¯•é‡å¯ç›¸å…³æœåŠ¡å¹¶ç¡®ä¿æœ¬åœ°ç«¯å£ç›‘å¬
4. æŸ¥çœ‹æ—¥å¿—ï¼š`logs/udp_mapping_*.log`

---

## ğŸ“œ License

æœ¬é¡¹ç›®éµå¾ª **MIT License** å‘è¡¨ï¼Œå¯è‡ªç”±ä½¿ç”¨ã€ä¿®æ”¹ã€åˆ†å‘ã€‚è¯¦æƒ…å‚è§ [LICENSE](./LICENSE)ã€‚

---

## ğŸ”„ å‡çº§æŒ‡å—

ä½¿ç”¨æœ€æ–°å®‰è£…è„šæœ¬å¯è‡ªåŠ¨æ£€æµ‹å¹¶æ›¿æ¢åˆ°æœ€æ–°ç‰ˆæœ¬ï¼š

```bash
bash <(curl -fsSL https://raw.githubusercontent.com/pjy02/Port-Mapping-Manage/main/install_pmm.sh)
```

è„šæœ¬ä¼šåœ¨ä¿ç•™ç°æœ‰é…ç½®çš„å‰æä¸‹å®Œæˆå‡çº§ã€‚

---

## ğŸ—‘ï¸ å¸è½½è„šæœ¬

```bash
pmm --uninstall
```

æˆ–åœ¨ä¸»èœå•è¾“å…¥ `99` æŒ‰æç¤ºå¸è½½ï¼Œå¹¶é€‰æ‹©æ˜¯å¦ä¿ç•™å¤‡ä»½æ–‡ä»¶ã€‚

---

## ğŸ¤ è´¡çŒ®æŒ‡å—

æ¬¢è¿æäº¤ PR æˆ– Issueï¼

1. Fork æœ¬ä»“åº“å¹¶åˆ›å»ºåˆ†æ”¯
2. æäº¤ä»£ç å‰è¯·è¿è¡Œ `shellcheck` ä¿è¯è„šæœ¬è´¨é‡
3. è¯¦ç»†æè¿°å˜æ›´å†…å®¹å’Œæµ‹è¯•ç»“æœ

---

## ğŸ“° æ›´æ–°æ—¥å¿—

### v4.0 - ğŸš€ é‡å¤§æ›´æ–° (2025-01-10)

**ğŸ”§ æ ¸å¿ƒä¿®å¤ä¸ä¼˜åŒ–**
- âœ… ä¿®å¤å‡½æ•°é‡å¤å®šä¹‰é—®é¢˜
- âœ… ä¿®å¤ `get_iptables_cmd()` å‡½æ•°å‚æ•°å¤„ç†é—®é¢˜
- âœ… ä¿®å¤ `check_port_conflicts()` IPç‰ˆæœ¬æ”¯æŒé—®é¢˜
- âœ… ä¿®å¤ `check_rule_active()` åè®®æ£€æµ‹é—®é¢˜
- âœ… å¢å¼º `sanitize_input()` å®‰å…¨æ€§éªŒè¯

**ğŸ›¡ï¸ ç¨³å®šæ€§ä¸å…¼å®¹æ€§**
- âœ… ä¿®å¤æ•°ç»„å¤„ç†å…¼å®¹æ€§é—®é¢˜
- âœ… å¢å¼ºé”™è¯¯å¤„ç†å’Œå›æ»šæœºåˆ¶
- âœ… å®Œå–„å˜é‡éªŒè¯å’Œç¯å¢ƒæ£€æŸ¥
- âœ… æ”¹è¿›æ—¥å¿—è®°å½•å’Œè°ƒè¯•åŠŸèƒ½
- âœ… ä¼˜åŒ–æ€§èƒ½å’Œæ·»åŠ ç¼“å­˜æœºåˆ¶

**ğŸ—‘ï¸ å¸è½½åŠŸèƒ½é‡æ„**
- âœ… ä¿®å¤è§„åˆ™åˆ é™¤é€»è¾‘é—®é¢˜
- âœ… æ”¹è¿› systemd æœåŠ¡æ¸…ç†æœºåˆ¶
- âœ… å¢å¼ºæƒé™æ£€æŸ¥å’Œé¢„éªŒè¯
- âœ… å®‰å…¨çš„è‡ªåˆ é™¤æœºåˆ¶
- âœ… æ™ºèƒ½è„šæœ¬è·¯å¾„æ£€æµ‹

**ğŸ“š ç”¨æˆ·ä½“éªŒæå‡**
- âœ… å…¨é¢æ›´æ–°å¸®åŠ©ä¿¡æ¯å’Œæ–‡æ¡£
- âœ… æ”¹è¿›äº¤äº’ç•Œé¢å’Œé”™è¯¯æç¤º
- âœ… å¢å¼ºè°ƒè¯•æ¨¡å¼å’Œè¯¦ç»†æ—¥å¿—
- âœ… å®Œå–„æ•…éšœæ’é™¤æŒ‡å—

### å†å²ç‰ˆæœ¬

| ç‰ˆæœ¬ | å˜æ›´ | æ—¥æœŸ |
| ---- | ---- | ---- |
| 3.6  | å®Œå–„æ›´æ–°æ£€æµ‹åŠŸèƒ½ï¼Œä¼˜åŒ–ç”¨æˆ·ä½“éªŒ | 2025-08-15 |
| 3.1  | å¢åŠ å®‰è£…è„šæœ¬ä¾èµ–è‡ªåŠ¨æ£€æµ‹ | 2025-08-02 |
| 3.0  | å…¨é¢é‡æ„ï¼Œå¢åŠ è¯Šæ–­ä¸ç›‘æ§ | 2025-08-02 |
| 2.0  | åˆå§‹å‘å¸ƒ | 2025-08-01 |

æ„Ÿè°¢æ‰€æœ‰è´¡çŒ®è€…ï¼
