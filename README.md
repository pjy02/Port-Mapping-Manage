# Port-Mapping-Manage

[![Version](https://img.shields.io/badge/version-3.1-blue)](https://github.com/pjy02/Port-Mapping-Manage/blob/main/port_mapping_manager.sh)
[![License](https://img.shields.io/badge/license-MIT-green)](https://github.com/pjy02/Port-Mapping-Manage/blob/main/LICENSE)

> å¼ºå¤§ä¸”æ˜“ç”¨çš„ iptables ç«¯å£æ˜ å°„ç®¡ç†è„šæœ¬ï¼Œæ”¯æŒ **TCP / UDP** åè®®ã€æ‰¹é‡æ“ä½œã€è§„åˆ™æŒä¹…åŒ–ã€å®æ—¶æµé‡ç›‘æ§ã€å¤‡ä»½ç®¡ç†ç­‰é«˜çº§ç‰¹æ€§ã€‚

---

## ğŸ“‘ é¡¹ç›®ç®€ä»‹

æœ¬è„šæœ¬æ—¨åœ¨ç®€åŒ– Linux æœåŠ¡å™¨ä¸Šçš„å¤§èŒƒå›´ç«¯å£è½¬å‘é…ç½®ä¸ç®¡ç†ï¼Œç‰¹åˆ«é€‚ç”¨äº **Hysteria 2 / Xray / iperf** ç­‰éœ€è¦æ˜ å°„å¤§é‡ç«¯å£çš„åº”ç”¨åœºæ™¯ã€‚

* **äº¤äº’å‹å¥½**ï¼šæä¾›å¤šçº§èœå•ï¼Œæ— éœ€è®°å¿†å¤æ‚å‘½ä»¤
* **åè®®çµæ´»**ï¼šæ”¯æŒ TCP / UDPï¼Œå¹¶å¯é€šè¿‡æ•°å­—å¿«é€Ÿé€‰æ‹©
* **æ‰¹é‡é…ç½®**ï¼šæ”¯æŒè¯»å–é…ç½®æ–‡ä»¶ä¸€æ¬¡æ€§å¯¼å…¥å¤šæ¡è§„åˆ™
* **å®æ—¶ç›‘æ§**ï¼šå†…ç½®æµé‡ç»Ÿè®¡ä¸é€Ÿç‡ç›‘æ§
* **å®‰å…¨å¯é **ï¼šè‡ªåŠ¨å¤‡ä»½è§„åˆ™ï¼Œæ”¯æŒé€‰æ‹©æ€§æ¢å¤ / æ¸…ç†
* **å¯ç§»æ¤æ€§**ï¼šå…¼å®¹ Debian / Ubuntu / CentOS / Rocky / AlmaLinux ç­‰å¸¸è§å‘è¡Œç‰ˆ

---

## ğŸš€ å¿«é€Ÿå¼€å§‹

> éœ€ **root** æƒé™æ‰§è¡Œï¼Œç¡®ä¿ç³»ç»Ÿå·²å®‰è£… `iptables` / `iptables-save` / `iptables-restore`ã€‚

```bash
# ä¸€é”®ä¸‹è½½å¹¶è¿è¡Œï¼ˆç¤ºä¾‹ï¼‰
bash <(curl -fsSL https://raw.githubusercontent.com/pjy02/Port-Mapping-Manage/refs/heads/main/install_pmm.sh)
```

### å¯é€‰å¯åŠ¨å‚æ•°

| å‚æ•° | è¯´æ˜ |
| ---- | ---- |
| `-v, --verbose` | æ˜¾ç¤ºæ›´å¤šè°ƒè¯•ä¿¡æ¯ |
| `--no-backup` | ç¦ç”¨è‡ªåŠ¨å¤‡ä»½ |
| `-h, --help` | æŸ¥çœ‹å¸®åŠ© |
| `--version` | æ˜¾ç¤ºè„šæœ¬ç‰ˆæœ¬ |

---

## ğŸ–¥ï¸ ä¸»èœå•ä¸€è§ˆ

| åºå· | åŠŸèƒ½ |
| ---- | ---- |
| 1 | æ–°å¢ç«¯å£æ˜ å°„ |
| 2 | æŸ¥çœ‹é¢„è®¾æ˜ å°„èŒƒå›´ |
| 3 | æŸ¥çœ‹å½“å‰æ˜ å°„è§„åˆ™ (Enhanced View) |
| 4 | è§„åˆ™ç®¡ç†ï¼šæ‰¹é‡åˆ é™¤ / ç«¯å£ä¿®æ”¹ / å¯ç”¨ç¦ç”¨ |
| 5 | ç³»ç»Ÿè¯Šæ–­ |
| 6 | æ‰¹é‡æ“ä½œï¼šå¯¼å…¥ / å¯¼å‡º / ç¤ºä¾‹é…ç½® |
| 7 | å¤‡ä»½ç®¡ç†ï¼šåˆ›å»º / æ¢å¤ / é€‰æ‹©æ€§æ¸…ç† |
| 8 | å®æ—¶ç›‘æ§æµé‡ |
| 9 | æ¢å¤é»˜è®¤è®¾ç½® |
| 10 | æ°¸ä¹…ä¿å­˜å½“å‰è§„åˆ™ |
| 11 | å¸®åŠ©ä¿¡æ¯ |
| 12 | ç‰ˆæœ¬ä¿¡æ¯ |
| 13 | é€€å‡ºè„šæœ¬ |

---

## ğŸ”§ æ–°å¢æ˜ å°„ç¤ºä¾‹

1. é€‰æ‹© **1. æ–°å¢ç«¯å£æ˜ å°„**
2. æŒ‰æç¤ºä¾æ¬¡è¾“å…¥ï¼š
   * èµ·å§‹ç«¯å£ï¼š`6000`
   * ç»ˆæ­¢ç«¯å£ï¼š`7000`
   * æœ¬åœ°æœåŠ¡ç«¯å£ï¼š`3000`
   * åè®®ï¼š`1`ï¼ˆTCPï¼‰æˆ– `2`ï¼ˆUDPï¼‰
3. ç¡®è®¤åå³åˆ»ç”Ÿæ•ˆï¼Œå¯åœ¨ **3. æŸ¥çœ‹å½“å‰æ˜ å°„è§„åˆ™** ä¸­éªŒè¯ã€‚

---

## ğŸ“‚ æ‰¹é‡å¯¼å…¥ç¤ºä¾‹æ–‡ä»¶

è„šæœ¬å¯è¯»å–ä»¥ä¸‹æ ¼å¼çš„é…ç½®æ–‡ä»¶æ‰¹é‡å¯¼å…¥è§„åˆ™ï¼š

```text:sample_rules.conf
# æ ¼å¼: start_port:end_port:service_port
6000:7000:3000
8000:9000:4000
10000:12000:5000
```

---

## ğŸ›¡ï¸ å¤‡ä»½ä¸æ¢å¤

* **è‡ªåŠ¨å¤‡ä»½**ï¼šæ¯æ¬¡æ›´æ”¹ iptables å‰è‡ªåŠ¨å¤‡ä»½åˆ° `backups/` ç›®å½•ï¼Œé»˜è®¤ä¿ç•™ 10 ä»½
* **é€‰æ‹©æ€§æ¸…ç†**ï¼šåœ¨å¤‡ä»½ç®¡ç†èœå•è¾“å…¥åºå·ï¼ˆæ”¯æŒç©ºæ ¼/é€—å·ç­‰ä»»æ„åˆ†éš”ï¼‰æˆ–è¾“å…¥ `all` ä¸€é”®æ¸…ç©º
* **æ¢å¤å¤‡ä»½**ï¼šæŒ‰åºå·é€‰æ‹©éœ€è¦æ¢å¤çš„å¤‡ä»½æ–‡ä»¶ï¼Œæ”¯æŒè¦†ç›–å½“å‰å…¨éƒ¨è§„åˆ™

---

## ğŸ“Š å®æ—¶ç›‘æ§

åœ¨ **8. å®æ—¶ç›‘æ§** ä¸­ï¼Œå¯æ¯ç§’æŸ¥çœ‹ç´¯è®¡æ•°æ®åŒ…ã€å­—èŠ‚æ•°ä¸å®æ—¶é€Ÿç‡ï¼Œæ–¹ä¾¿æ’æŸ¥æµé‡ç“¶é¢ˆã€‚

---

## ğŸ†˜ æ•…éšœæ’æŸ¥

1. ç¡®è®¤è„šæœ¬ä»¥ **root** èº«ä»½æ‰§è¡Œ
2. æ£€æŸ¥ `iptables` æ˜¯å¦æ­£å¸¸å·¥ä½œï¼š`iptables -L -n`
3. è‹¥è§„åˆ™æœªç”Ÿæ•ˆï¼Œå°è¯•é‡å¯ç›¸å…³æœåŠ¡å¹¶ç¡®ä¿æœ¬åœ°ç«¯å£ç›‘å¬
4. æŸ¥çœ‹æ—¥å¿—ï¼š`logs/udp_mapping_*.log`

---

## ğŸ“œ License

æœ¬é¡¹ç›®éµå¾ª **MIT License** å‘è¡¨ï¼Œå¯è‡ªç”±ä½¿ç”¨ã€ä¿®æ”¹ã€åˆ†å‘ã€‚è¯¦æƒ…å‚è§ [LICENSE](./LICENSE)ã€‚

---

## ğŸ”„ å‡çº§æŒ‡å—

ä½¿ç”¨æœ€æ–°å®‰è£…è„šæœ¬å¯è‡ªåŠ¨æ£€æµ‹å¹¶æ›¿æ¢åˆ°æœ€æ–°ç‰ˆæœ¬ï¼š

```bash
bash <(curl -fsSL https://raw.githubusercontent.com/pjy02/Port-Mapping-Manage/main/install_pmm.sh)
```

è„šæœ¬ä¼šåœ¨ä¿ç•™ç°æœ‰é…ç½®çš„å‰æä¸‹å®Œæˆå‡çº§ã€‚

---

## ğŸ—‘ï¸ å¸è½½è„šæœ¬

```bash
pmm --uninstall
```

æˆ–åœ¨ä¸»èœå•è¾“å…¥ `99` æŒ‰æç¤ºå¸è½½ï¼Œå¹¶é€‰æ‹©æ˜¯å¦ä¿ç•™å¤‡ä»½æ–‡ä»¶ã€‚

---

## ğŸ¤ è´¡çŒ®æŒ‡å—

æ¬¢è¿æäº¤ PR æˆ– Issueï¼

1. Fork æœ¬ä»“åº“å¹¶åˆ›å»ºåˆ†æ”¯
2. æäº¤ä»£ç å‰è¯·è¿è¡Œ `shellcheck` ä¿è¯è„šæœ¬è´¨é‡
3. è¯¦ç»†æè¿°å˜æ›´å†…å®¹å’Œæµ‹è¯•ç»“æœ

---

## ğŸ“° æ›´æ–°æ—¥å¿—

| ç‰ˆæœ¬ | å˜æ›´ | æ—¥æœŸ |
| ---- | ---- | ---- |
| 3.1  | å¢åŠ å®‰è£…è„šæœ¬ä¾èµ–è‡ªåŠ¨æ£€æµ‹ | 2025-08-02 |
| 3.0  | å…¨é¢é‡æ„ï¼Œå¢åŠ è¯Šæ–­ä¸ç›‘æ§ | 2025-08-02 |
| 2.0  | åˆå§‹å‘å¸ƒ | 2025-08-01 |

æ„Ÿè°¢æ‰€æœ‰è´¡çŒ®è€…ï¼
